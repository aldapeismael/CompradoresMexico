@{
    Page.Title = "Publicación";

    Layout = "~/_SiteLayout.cshtml";
    int IntIdPublicacion = int.Parse(Request.QueryString["IdPublicacion"]?.ToString() ?? "0");

    ObjetoBusqueda objetoBusqueda = new ObjetoBusqueda();
    objetoBusqueda.IntEjecuta = 0;
    objetoBusqueda.IntId1 = IntIdPublicacion;
    if (IntIdPublicacion == 0)
    {
        Response.Redirect("~/Views/Default/Default.cshtml");
    }
    var lstObjPublicacion = new Publicacion().ObtenerListaGenerica(objetoBusqueda);
    int i = 0;

    Publicacion objPublicacionPrimero = new Publicacion();
    if (lstObjPublicacion.Count > 0)
    {
        objPublicacionPrimero = lstObjPublicacion.First();
    }
    string strJsonConfiguracionNotificacion = "[]";
    Parametro objParametro = new Parametro();
    objParametro.IntTipoBusqueda = 1;
    objParametro.StrCveParametro = "notificacion_configuracionJson";
    objParametro.ObtenerPorClaveParametro();
    if (objParametro != null)
    {
        strJsonConfiguracionNotificacion = objParametro.StrValor1char;
    }
}
<script src="@VariableGlobal.StrUrlSitio/Scripts/plugins/fullcalendar/moment.min.js"></script>

<script src="@VariableGlobal.StrUrlSitio/Scripts/jquery.signalR-2.4.1.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="@VariableGlobal.StrUrlSitio/signalr/hubs"></script>
<script src="@VariableGlobal.StrUrlSitio/Scripts/utileriaNotificacion.js"></script>

<link rel="stylesheet" href="@VariableGlobal.StrUrlSitio/css/productDetail.css">
@foreach (var objPublicacion in lstObjPublicacion)
{
    <section style="margin-top: 15%;
        margin-bottom: 15%; height: 100%;" class="containerProductoDetalle">
        <div class="containerCarusel">
            <div class="exit">
                <i class="material-icons md-48" id="btn_PantallaAnterior">arrow_back_ios</i>
            </div>
            <img src="@VariableGlobal.StrUrlSitio/Views/Publicacion/PublicacionImagen/@objPublicacion.StrNombreArchivo" alt="">
        </div>
        <div class="containerTittle">
            <div>
                <p class="tittle">@objPublicacion.StrCveCategoria</p>
                <p class="category">@objPublicacion.StrCveCategoria <span>DISPONIBLE</span></p>
            </div>
            <div class="containerPrice">
                <div>
                    <p>$@objPublicacion.DecPresupuesto.ToString("#,###,###.##")</p>
                </div>
                @if (objPublicacion.IntIdUsuario != VariableGlobal.SessionIntIdUsuario)
                {
                    <button type="button" id="btn_Contactar" data-id="@objPublicacion.IntIdPublicacion" class="btn btn-block">Contactar por chat</button>
                }
            </div>
        </div>
        <div class="ContainerDesc">
            @objPublicacion.StrDescCategoria
            <br />
            @objPublicacion.StrDescripcion
        </div>
        <div class="footer">
            <i></i>
            <i></i>
        </div>
    </section>
}
<script>
    var str_JsonNotificacion = JSON.parse('@Html.Raw(strJsonConfiguracionNotificacion)');
    $(document).ready(function () {
        var obj_Notificacion = new class_notificacion("@VariableGlobal.StrUrlSitio", "@VariableGlobal.StrUrlApi"
            , str_JsonNotificacion.frecuenciaBusqueda
            , str_JsonNotificacion.minutosDiferencia
            , str_JsonNotificacion.altoNotificacion, "@VariableGlobal.SessionIntIdUsuario"
            , @objPublicacionPrimero.IntIdUsuario);
        $("#btn_Contactar").click(function () {
            let int_IdLiquidacion = $(this).data("id");
            fn_AbriModalChat(int_IdLiquidacion);
        });
        $("#btn_PantallaAnterior").click(function () {
            window.history.back();
        });
    });

    function fn_AbriModalChat(param_Int_IdLiquidacion) {
        var strWith = "95%";
        if (document.body.clientWidth > 760)
            strWith = "60%";

        $.pgwModal({//abre ABC not
            url: "@VariableGlobal.StrUrlSitio/Views/Chat/chat.cshtml?Popup=1&IdPublicacion=" + param_Int_IdLiquidacion,
            loadingContent: '<span style="text-align:center">Cargando</span>',
            closeOnBackgroundClick: false,
            title: "Contactar",
            maxWidth: strWith
        });
    }


</script>
