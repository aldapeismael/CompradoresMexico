@{
    Page.Title = "Mis Chat";

    int IntPopUp = int.Parse(Request.QueryString["Popup"]?.ToString() ?? "0");
    if (IntPopUp == 0)
    {
        Layout = "~/_SiteLayout.cshtml";
    }

    ObjetoBusqueda objetoBusqueda = new ObjetoBusqueda();
    objetoBusqueda.IntEjecuta = 103;
    if (1 == 0)
    {
        Response.Redirect("~/Views/Default/Default.cshtml");
    }
    var lstObjChat = new Chat().ObtenerListaGenerica(objetoBusqueda);

    string strJsonConfiguracionNotificacion = "[]";
    Parametro objParametro = new Parametro();
    objParametro.IntTipoBusqueda = 1;
    objParametro.StrCveParametro = "notificacion_configuracionJson";
    objParametro.ObtenerPorClaveParametro();
    if (objParametro != null)
    {
        strJsonConfiguracionNotificacion = objParametro.StrValor1char;
    }

    int IntIdUsuarioDestino = 0;
}
<style>
    .panel-primary > .panel-heading {
        color: #fff;
        background-color: #337ab7;
        border-color: #337ab7;
    }

    .panel-heading {
        padding: 10px;
        border-bottom: 1px solid transparent;
        border-top-left-radius: 3px;
        border-top-right-radius: 3px;
    }

    .widthSet {
        max-width: 50px;
    }

    .heightSet {
        max-height: 50px;
    }
</style>
<script src="@VariableGlobal.StrUrlSitio/Scripts/plugins/fullcalendar/moment.min.js"></script>

<script src="@VariableGlobal.StrUrlSitio/Scripts/jquery.signalR-2.4.1.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="@VariableGlobal.StrUrlSitio/signalr/hubs"></script>
<script src="@VariableGlobal.StrUrlSitio/Scripts/utileriaNotificacion.js"></script>
<br />
<br />
<br />
<div style="padding: 15px">
    <div class="panel panel-primary">
        <div class="panel-heading">Mis Chats</div>
        <div class="panel-body" style="padding-top: 10px">
            <table class="table table-bordered" id="tblChats">
                <thead style="display:none">
                    <tr>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var objChat in lstObjChat)
                    {
                        <tr>
                            <td style="width: 20%">
                                <img class="rounded-circle widthSet heightSet" src="@(VariableGlobal.StrUrlSitio + "/Views/Publicacion/PublicacionImagen/" + objChat.StrImagen1)" alt="">
                            </td>
                            <td style="width: 80%">
                                <div class="PanelNombre"><a href="#" id="btn_Nombre" class="btn_Nombre" data-id="@objChat.IntIdUsuarioDestino" data-idpublicacion="@objChat.IntIdPublicacion" data-idchat="@objChat.IntIdChat"><strong>@objChat.StrCveUsuario</strong></a></div>
                                <span style="white-space: pre-line"></span>
                                <div class="" style="font-size:12px; font-weight:bold">@objChat.StrCveCategoria : @(objChat.StrDescripcion.Length > 20 ? (objChat.StrDescripcion.Substring(0,20) + "...") : objChat.StrDescripcion) </div>
                                <span style="white-space: pre-line"></span>
                                <div class="Ultimomensaje">@(objChat.StrMensaje.Length > 20 ? (objChat.StrMensaje.Substring(0,20) + "...") : objChat.StrMensaje) </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
     var str_JsonNotificacion = JSON.parse('@Html.Raw(strJsonConfiguracionNotificacion)');
    $(document).ready(function () {
        $('#tblChats').DataTable({
            rowReorder: {
                selector: 'td:nth-child(2)'
            },
            "language": obj_ClaseDataTable.json_LanguageDataTable,
            "bLengthChange": false,
            responsive: true
        });
        
        var obj_Notificacion = new class_notificacion("@VariableGlobal.StrUrlSitio", "@VariableGlobal.StrUrlApi"
            , str_JsonNotificacion.frecuenciaBusqueda
            , str_JsonNotificacion.minutosDiferencia
            , str_JsonNotificacion.altoNotificacion
            , "@VariableGlobal.SessionIntIdUsuario"
            , @IntIdUsuarioDestino);
        $(".btn_Nombre").click(function () {
            let int_IdUsuarioDestino = $(this).data("id");
            let int_IdChat = $(this).data("idchat");
            let int_IdPublicacion = $(this).data("idpublicacion");
            instanciaClase._intIdUsuarioDestino = int_IdUsuarioDestino;
            fn_AbriModalChat(int_IdChat, int_IdPublicacion);
        });
    });

    function fn_AbriModalChat(param_Int_IdChat, param_int_IdPublicacion) {
        $.pgwModal({//abre ABC not
            url: "@VariableGlobal.StrUrlSitio/Views/Chat/chat.cshtml?Popup=1&IdChat=" + param_Int_IdChat + "&IdPublicacion=" + param_int_IdPublicacion,
            loadingContent: '<span style="text-align:center">Cargando</span>',
            closeOnBackgroundClick: false,
            title: "Contactar",
            maxWidth: '95%'
        });
    }
</script>